name: ë””ì‹œì¸ì‚¬ì´ë“œ ê´‘ê³  ëª¨ë‹ˆí„°ë§ ìë™í™”

on:
  workflow_dispatch:
  schedule:
    - cron: '0 21 * * *' # KST ì˜¤ì „ 6ì‹œ ì‹¤í–‰

jobs:
  # 1ë‹¨ê³„: 1ëŒ€ì˜ ì»´í“¨í„°ê°€ ë¨¼ì € ë‚˜ì„œì„œ ì‹œíŠ¸ ì¤‘ë³µ ë°ì´í„°ë¥¼ ì‹¹ ì§€ì›ë‹ˆë‹¤.
  clean-sheet:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    - run: |
        python -m pip install --upgrade pip
        pip install gspread
    - env:
        GOOGLE_API_KEY: ${{ secrets.GOOGLE_API_KEY }}
      run: echo "$GOOGLE_API_KEY" > service_account2020.json
    - name: êµ¬ê¸€ ì‹œíŠ¸ ì´ˆê¸°í™” (ì˜¤ëŠ˜ ë‚ ì§œ)
      run: python -u clean_sheet.py

  # 2ë‹¨ê³„: ì²­ì†Œê°€ ëë‚˜ë©´ ì»´í“¨í„° 5ëŒ€ê°€ ë™ì‹œì— ì¼œì ¸ì„œ ë¯¸ì¹œ ì†ë„ë¡œ ê¸ì–´ì˜µë‹ˆë‹¤.
  scrape-data:
    needs: clean-sheet
    runs-on: ubuntu-latest
    strategy:
      matrix:
        chunk: [0, 1, 2, 3, 4] # ğŸ”¥ ì—¬ê¸°ê°€ í•µì‹¬! ì„œë²„ 5ëŒ€ ë™ì‹œ ê°€ë™
    steps:
    - uses: actions/checkout@v3
    - uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    - run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        playwright install chromium
    - env:
        GOOGLE_API_KEY: ${{ secrets.GOOGLE_API_KEY }}
      run: echo "$GOOGLE_API_KEY" > service_account2020.json
    - name: ìˆ˜ì§‘ ë¡œë´‡ ë™ì‹œ ê°€ë™ (ì„œë²„ ë²ˆí˜¸ ${{ matrix.chunk }})
      env:
        CHUNK_INDEX: ${{ matrix.chunk }}
        TOTAL_CHUNKS: 5
      run: python -u dc_monitor.py
